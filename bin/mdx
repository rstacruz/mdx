#!/usr/bin/env node

var Extractor = require('../index').Extractor;

if (!process.parent) run();

/**
 * Runs.
 */

function run() {
  var read = require('read-input');
  var argv = yargs().argv;
  var ex = new Extractor();

  read(argv._).then(function (res) {
    // non-fatal errors
    if (res.error) console.warn(res.error.message);
    
    res.files.forEach(function (f) {
      ex.push(f.name, f.data);
    });

    console.log(JSON.stringify(ex.toJson(), null, 2));

  }).catch(function (err) {
    throw err;
  });
}

function yargs() {
  return require('yargs')
    .version(require('../package.json').version)
    .alias('h', 'help')
    .help('help')
    .option('v', {
      alias: 'version',
      describe: 'Show version info'
    })

    .usage('Usage: $0 <files>')

    .option('f', {
      alias: 'format',
      type: 'string',
      describe: 'set output format {json,markdown}'
    })

    .example('$0 lib/*.js')
    .showHelpOnFail(false, "Specify --help for available options")
    .strict();
}
